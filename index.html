<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ó–∞–ø—Ä–æ—à–µ–Ω–Ω—è –Ω–∞ –≤–µ—Å—ñ–ª–ª—è ‚Äî –Ø–Ω–∏ & –¢–∞—Ä–∞—Å–∞</title>
  <meta name="description" content="–ó–∞–ø—Ä–æ—à–µ–Ω–Ω—è –Ω–∞ –≤–µ—Å—ñ–ª–ª—è –Ø–Ω–∏ —Ç–∞ –¢–∞—Ä–∞—Å–∞." />

  <style>
    :root{
      --bg:#0b0b0f;
      --card:rgba(255,255,255,.06);
      --border:rgba(255,255,255,.12);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.72);
      --accent:#f5d7a1;
      --accent2:#f88749;
      --shadow:0 20px 60px rgba(0,0,0,.45);
      --radius:22px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; color:var(--text);
      font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:
        radial-gradient(900px 600px at 20% 10%, rgba(245,215,161,.18), transparent 60%),
        radial-gradient(800px 500px at 80% 30%, rgba(248,135,73,.14), transparent 55%),
        radial-gradient(700px 500px at 50% 95%, rgba(255,255,255,.06), transparent 60%),
        var(--bg);
      overflow-x:hidden;
    }
    .wrap{max-width:980px;margin:0 auto;padding:28px 18px 70px}

    .badge{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 12px;border:1px solid var(--border);
      background:rgba(255,255,255,.04);border-radius:999px;
      backdrop-filter:blur(10px)
    }
    .dot{width:8px;height:8px;border-radius:50%;background:var(--accent2);box-shadow:0 0 0 4px rgba(248,135,73,.16)}
    .btn{
      display:inline-flex;align-items:center;justify-content:center;gap:10px;
      padding:12px 16px;border-radius:999px;border:1px solid var(--border);
      background:rgba(255,255,255,.06);text-decoration:none;color:inherit;
      transition:transform .12s ease, background .12s ease, border-color .12s ease;
      cursor:pointer; user-select:none;
    }
    .btn:hover{transform:translateY(-1px);background:rgba(255,255,255,.08);border-color:rgba(255,255,255,.18)}
    .btn.primary{
      border-color:rgba(245,215,161,.55);
      background:linear-gradient(135deg, rgba(245,215,161,.22), rgba(248,135,73,.12));
    }

    .topbar{display:flex;align-items:center;justify-content:space-between;gap:14px;padding:10px 0 18px}

    .hero{
      position:relative;padding:34px 22px;border-radius:var(--radius);
      border:1px solid var(--border);
      background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      box-shadow:var(--shadow);overflow:hidden;
    }
    .glow{
      position:absolute;inset:-60px;
      background:
        radial-gradient(280px 220px at 18% 15%, rgba(245,215,161,.26), transparent 60%),
        radial-gradient(240px 190px at 78% 25%, rgba(248,135,73,.18), transparent 62%),
        radial-gradient(300px 220px at 50% 95%, rgba(255,255,255,.09), transparent 65%);
      filter:blur(6px);opacity:.9;pointer-events:none;
    }
    .hero-grid{position:relative;display:grid;grid-template-columns:1.2fr .8fr;gap:18px}
    @media (max-width:820px){.hero-grid{grid-template-columns:1fr}}
    .kicker{color:var(--muted);letter-spacing:.12em;font-size:16px}
    h1{margin:10px 0 8px;font-size:54px;line-height:1.05;letter-spacing:-.02em}
    @media (max-width:520px){
      h1{font-size:40px}
      .topbar {flex-direction: column; align-items: stretch; gap: 8px;}
      .badge {flex: 1 0 100%; justify-content: center;}
    }
    .sub{color:var(--muted);font-size:18px;max-width:55ch;margin:0 0 18px}
    .chips{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px}
    .chip{
      padding:8px 10px;border-radius:999px;border:1px solid var(--border);
      background:rgba(255,255,255,.04);color:rgba(255,255,255,.85);font-size:14px
    }

    .card{
      border:1px solid var(--border);
      background:rgba(255,255,255,.04);
      border-radius:var(--radius);
      padding:18px;
      box-shadow:0 12px 36px rgba(0,0,0,.28);
    }
    .card h2{margin:0 0 10px;font-size:18px;letter-spacing:-.01em}

    .timeline{display:flex;flex-direction:column;gap:12px;margin:0;padding:0;list-style:none}
    .step{
      display:flex;gap:12px;align-items:flex-start;
      padding:12px;border-radius:18px;border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.12);
    }
    .time{min-width:72px;font-weight:700;color:var(--accent);font-variant-numeric:tabular-nums}
    .title{margin:0;font-weight:650}
    .step p{margin:0;color:var(--muted)}
    .divider{height:1px;background:rgba(255,255,255,.10);margin:14px 0}
    .muted{color:var(--muted)}

    /* countdown */
    .countdown{
      display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-top:12px
    }
    .cd{
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.04);
      border-radius:18px;padding:12px 10px;text-align:center
    }
    .cd .n{font-size:26px;font-weight:750;letter-spacing:-.02em}
    .cd .l{font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:.12em}
    @media (max-width:520px){
      .countdown{grid-template-columns:repeat(2,1fr)}
      .step { font-size: 14px;}
      .time { min-width: 50px; }
    }

    .footer{margin-top:22px;display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:space-between;color:var(--muted);font-size:14px}
    .small{font-size:13px;color:rgba(255,255,255,.68)}
    .hidden{display:none !important;}

    /* =========================
       INTRO OVERLAY + ENVELOPE
       ========================= */
    .intro{
      position:fixed; inset:0; z-index:9999;
      display:flex; align-items:center; justify-content:center;
      background:
        radial-gradient(800px 600px at 50% 35%, rgba(245,215,161,.14), transparent 60%),
        rgba(0,0,0,.65);
      backdrop-filter: blur(8px);
      transition: opacity .45s ease, transform .45s ease;
    }
    .intro.is-hiding{ opacity:0; transform: scale(1.02); pointer-events:none; }
    .intro .hint{
      position:absolute; bottom:26px; left:0; right:0;
      text-align:center; color:rgba(255,255,255,.72); font-size:14px;
    }
    .intro .hint b{ color:rgba(255,255,255,.9); }

    .envelopeBtn{
      border:0; background:transparent; padding:0;
      cursor:pointer;
      transform: translateZ(0);
      user-select:none;
    }
    .envelopeWrap{
      width:min(360px, 78vw);
      aspect-ratio: 4 / 3;
      position:relative;
      filter: drop-shadow(0 24px 70px rgba(0,0,0,.55));
      transition: transform .25s ease;
    }
    .envelopeBtn:hover .envelopeWrap{ transform: translateY(-2px); }

    /* Simple drawn envelope */
    .envBody{
      position:absolute; inset:0;
      border-radius: 22px;
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
      border: 1px solid rgba(255,255,255,.16);
      overflow:hidden;
    }
    .envBack{
      position:absolute; inset:18px 16px 20px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
    }
    .envFront{
      position:absolute; left:0; right:0; bottom:0; height:58%;
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(0,0,0,.18));
      border-top:1px solid rgba(255,255,255,.12);
      clip-path: polygon(0 100%, 100% 100%, 100% 0, 50% 52%, 0 0);
    }
    .envFlap{
      position:absolute; left:0; right:0; top:0; height:56%;
      background: linear-gradient(180deg, rgba(245,215,161,.18), rgba(255,255,255,.06));
      border-bottom:1px solid rgba(255,255,255,.12);
      clip-path: polygon(0 0, 100% 0, 50% 78%);
      transform-origin: 50% 0%;
      transition: transform .35s ease;
    }
    .envSeal{
      position:absolute; left:50%; top:55%;
      width:64px; height:64px;
      transform: translate(-50%,-50%);
      border-radius: 999px;
      border:1px solid rgba(245,215,161,.55);
      background: radial-gradient(circle at 30% 30%, rgba(245,215,161,.22), rgba(248,135,73,.10));
      box-shadow: 0 12px 30px rgba(0,0,0,.25);
      display:flex; align-items:center; justify-content:center;
      color: rgba(255,255,255,.85);
      font-weight:700;
      letter-spacing:.06em;
    }
    .envTitle{
      position:absolute; left:0; right:0; top:-55px;
      text-align:center;
      color: rgba(255,255,255,.92);
      font-weight:650;
      letter-spacing:-.01em;
      font-size:18px;
    }

    /* Fireworks canvas */
    #fx{
	  position:fixed; inset:0; z-index:9998;
	  pointer-events:none;
	  opacity:0;
	  transition: opacity .25s ease;
	  filter: blur(.25px) saturate(1.15);
	}
	#fx.on{ opacity:1; }
  </style>
</head>

<body>
  <!-- FIREWORKS -->
  <canvas id="fx"></canvas>

  <!-- INTRO OVERLAY -->
  <div class="intro" id="intro">
    <button class="envelopeBtn" id="openEnvelope" type="button" aria-label="–í—ñ–¥–∫—Ä–∏—Ç–∏ –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—è">
      <div class="envelopeWrap">
        <div class="envTitle">–¶–µ –Ω–µ <b>—Å–ø–∞–º</b>,</br> –∞ –Ω–∞—à–µ <b>–∑–∞–ø—Ä–æ—à–µ–Ω–Ω—è</b></div>
        <div class="envBody">
          <div class="envBack"></div>
          <div class="envFlap" id="envFlap"></div>
          <div class="envFront"></div>
          <div class="envSeal">OPEN</div>
        </div>
      </div>
    </button>
  </div>

  <!-- MAIN CONTENT (–ø–æ–∫–∞–∑—É—î–º–æ –ø—ñ—Å–ª—è —ñ–Ω—Ç—Ä–æ) -->
  <div class="wrap hidden" id="main">
    <div class="topbar">
      <div class="badge">
        <span class="dot"></span>
        <span class="small" id="topBadge">–ó–∞–ø—Ä–æ—à–µ–Ω–Ω—è</span>
      </div>
      <div class="badge" id="familyBadge">
	  <span class="dot"></span>
	  <span> –ù–∞ –≤–µ—Å—ñ–ª–ª—è <b>–î–º–∏—Ç—Ä–∏–∫—ñ–≤</b></span>
	 
	  </div>
    </div>

    <section class="hero" aria-label="–ó–∞–ø—Ä–æ—à–µ–Ω–Ω—è">
      <div class="glow"></div>
      <div class="hero-grid">
        <div>
          <div class="kicker" id="dearLine">–ó–∞–ø—Ä–æ—à–µ–Ω–Ω—è</div>
          <h1>–Ø–Ω–∞ <span style="color:var(--accent)">&</span> –¢–∞—Ä–∞—Å</h1>

          <!-- –ü—É–±–ª—ñ—á–Ω–∏–π —Ç–µ–∫—Å—Ç -->
          <p class="sub" id="publicSub">
            –ë—É–¥–µ–º–æ —Ä–∞–¥—ñ –±–∞—á–∏—Ç–∏ –≤–∞—Å –ø–æ—Ä—É—á —É —Ü–µ–π –¥–µ–Ω—å üíõ
          </p>

          <!-- –ü—Ä–∏–≤–∞—Ç–Ω—ñ –¥–µ—Ç–∞–ª—ñ -->
          <div id="privateInfo">
            <p class="sub" style="margin-top:-6px">
              27 –≥—Ä—É–¥–Ω—è –º–∏ –æ—Ñ—ñ—Ü—ñ–π–Ω–æ —Å—Ç–∞–Ω–µ–º–æ —Å—ñ–º‚Äô—î—é üíç
            </p>

            <div class="chips">
              <span class="chip">üï∞ –£—Ä–æ—á–∏—Å—Ç–∞ —á–∞—Å—Ç–∏–Ω–∞: <b>12:20</b></span>
              <span class="chip">ü•Ç –ë–∞–Ω–∫–µ—Ç: <b>13:00</b></span>
              <span class="chip">üìç –†–µ—Å—Ç–æ—Ä–∞–Ω: <b>–†–æ–Ω–¥–µ–ª—å</b></span>
            </div>

            <div class="divider"></div>
            <div class="muted">–î–æ –ø–æ–¥—ñ—ó –∑–∞–ª–∏—à–∏–ª–æ—Å—å:</div>
            <div class="countdown" aria-label="–¢–∞–π–º–µ—Ä –¥–æ –ø–æ–¥—ñ—ó">
              <div class="cd"><div class="n" id="d">‚Äî</div><div class="l">–¥–Ω—ñ–≤</div></div>
              <div class="cd"><div class="n" id="h">‚Äî</div><div class="l">–≥–æ–¥</div></div>
              <div class="cd"><div class="n" id="m">‚Äî</div><div class="l">—Ö–≤</div></div>
              <div class="cd"><div class="n" id="s">‚Äî</div><div class="l">—Å–µ–∫</div></div>
            </div>

            <p class="small" style="margin-top:12px">
              –Ø–∫—â–æ –Ω–µ –≤–∏–π–¥–µ –±—É—Ç–∏ –Ω–∞ —Ä–æ–∑–ø–∏—Å—ñ ‚Äî –ø—Ä–∏—Ö–æ–¥—å—Ç–µ –æ–¥—Ä–∞–∑—É –Ω–∞ –±–∞–Ω–∫–µ—Ç, –±–µ–∑ –≤–∞—Å —Å–≤—è—Ç–∫—É–≤–∞–Ω–Ω—è –±—É–¥–µ –Ω–µ –ø–æ–≤–Ω–∏–º üíõ
            </p>
          </div>

          <!-- –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è ‚Äú–Ω–µ –∑ —Å–ø–∏—Å–∫—É‚Äù -->
          <div class="card hidden" id="lockedNote" style="margin-top:14px">
            <h2 style="margin-bottom:6px">–î–µ—Ç–∞–ª—ñ –ø–æ–¥—ñ—ó</h2>
            <p class="muted" style="margin:0">
              –î–µ—Ç–∞–ª—ñ (–¥–∞—Ç–∞, —á–∞—Å —ñ –ª–æ–∫–∞—Ü—ñ—è) –¥–æ—Å—Ç—É–ø–Ω—ñ –ª–∏—à–µ –∑–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏–º –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º.
            </p>
          </div>
        </div>

        <!-- –ü—Ä–∏–≤–∞—Ç–Ω–∏–π –±–ª–æ–∫ -->
        <div class="card" id="timing">
          <h2>–¢–∞–π–º—ñ–Ω–≥ –¥–Ω—è</h2>
          <ul class="timeline">
            <li class="step">
              <div class="time">12:20</div>
              <div>
                <p class="title">–£—Ä–æ—á–∏—Å—Ç–∞ —á–∞—Å—Ç–∏–Ω–∞</p>
                <p>–†–æ–∑–ø–∏—Å / –æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π –º–æ–º–µ–Ω—Ç.</p>
              </div>
            </li>
            <li class="step">
              <div class="time">13:00</div>
              <div>
                <p class="title">–ë–∞–Ω–∫–µ—Ç —É ‚Äú–†–æ–Ω–¥–µ–ª—å‚Äù</p>
                <p>–ó–∞–ø—ñ–∑–Ω—é–≤–∞—Ç–∏—Å—å –º–æ–∂–Ω–∞‚Ä¶ –∞–ª–µ –¥–∞–≤–∞–π—Ç–µ –±–µ–∑ —Ü—å–æ–≥–æ üòÑ</p>
              </div>
            </li>
          </ul>

          <div class="divider"></div>

          <!-- –ó–ê–ì–û–¢–û–í–ö–ê: —Ç–∏ —Å–∞–º –≤—Å—Ç–∞–≤–∏—à –∞–¥—Ä–µ—Å—É/–ª—ñ–Ω–∫ -->
          <a style="width: 100%" class="btn primary"
             href="https://maps.app.goo.gl/pHaArKbsiymkTwkX9"
             target="_blank" rel="noopener">
            –í—ñ–¥–∫—Ä–∏—Ç–∏ –≤ Google Maps
          </a>

          <button style="width: 100%; margin-top: 15px;"
                  class="btn primary"
                  id="addToCalendarBtn"
                  type="button">
            –î–æ–¥–∞—Ç–∏ –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä
          </button>
        </div>
      </div>
    </section>

    <div class="footer">
      <div>–ó –ª—é–±–æ–≤‚Äô—é, <b>–Ø–Ω–∞ —ñ –¢–∞—Ä–∞—Å</b> üíõ</div>
      <div class="small">¬© <span id="year"></span></div>
    </div>
  </div>

  <script>
    // =========================
    // Intro + Fireworks
    // =========================
    const intro = document.getElementById('intro');
    const main = document.getElementById('main');
    const openEnvelope = document.getElementById('openEnvelope');
    const envFlap = document.getElementById('envFlap');

    // =========================
// Fireworks (enhanced)
// =========================
const fx = document.getElementById('fx');
const ctx = fx.getContext('2d', { alpha: true });

function resizeFx(){
  fx.width = Math.floor(window.innerWidth * devicePixelRatio);
  fx.height = Math.floor(window.innerHeight * devicePixelRatio);
  fx.style.width = window.innerWidth + 'px';
  fx.style.height = window.innerHeight + 'px';
  ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
}
window.addEventListener('resize', resizeFx);
resizeFx();

const rockets = [];
const sparks = [];
const blooms = [];

function rand(a,b){ return a + Math.random()*(b-a); }
function pick(arr){ return arr[(Math.random()*arr.length)|0]; }

const PALETTE = [
  '#ffd39b', '#ffb86b', '#ff8a4c', '#ffe7c6',
  '#f5d7a1', '#f88749', '#fff3d8', '#ffcf7a'
];

function spawnRocket(x, yFrom, yTo){
  rockets.push({
    x,
    y: yFrom,
    tx: x + rand(-40, 40),
    ty: yTo,
    vx: rand(-0.5, 0.5),
    vy: rand(-10.5, -13.5),
    life: 80,
    color: pick(PALETTE),
  });
}

function spawnTrail(x, y, color){
  // –≥—É—Å—Ç–∏–π ‚Äú—à–ª–µ–π—Ñ‚Äù
  for (let i=0;i<3;i++){
    sparks.push({
      x: x + rand(-1,1),
      y: y + rand(-1,1),
      vx: rand(-0.8,0.8),
      vy: rand(0.6,2.2),
      g: rand(0.04,0.08),
      life: rand(18,28),
      size: rand(1.1,2.0),
      color,
      alpha: 1,
    });
  }
}

function spawnBloom(x, y, baseColor){
  // ‚Äú—Å–µ—Ä—Ü–µ–≤–∏–Ω–∞‚Äù
  blooms.push({ x, y, r: 0, life: 20, color: baseColor });

  const count = 160; // —ñ–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ñ—Å—Ç—å –≤–∏–±—É—Ö—É
  for (let i=0;i<count;i++){
    const a = Math.random() * Math.PI * 2;
    const sp = rand(1.8, 7.5);
    sparks.push({
      x, y,
      vx: Math.cos(a) * sp,
      vy: Math.sin(a) * sp,
      g: rand(0.03,0.06),
      life: rand(52, 85),
      size: rand(1.0, 2.2),
      color: (Math.random() < 0.65) ? baseColor : pick(PALETTE),
      alpha: 1,
      tw: Math.random() < 0.45, // flicker
    });
  }

  // ‚Äú–∑—ñ—Ä–æ—á–∫–∏-–ø—Ä–æ–º–µ–Ω—ñ‚Äù —è–∫ –Ω–∞ –≥—ñ—Ñ–∫–∞—Ö
  const rays = 22;
  for (let i=0;i<rays;i++){
    const a = (i / rays) * Math.PI * 2 + rand(-0.06,0.06);
    const sp = rand(5.5, 10.5);
    sparks.push({
      x, y,
      vx: Math.cos(a) * sp,
      vy: Math.sin(a) * sp,
      g: rand(0.02,0.05),
      life: rand(38, 62),
      size: rand(1.5, 2.7),
      color: '#ffe7c6',
      alpha: 1,
      ray: true,
    });
  }
}

let fxOn = false;

function runFireworks(durationMs = 1400){
  fx.classList.add('on');
  fxOn = true;

  rockets.length = 0;
  sparks.length = 0;
  blooms.length = 0;

  const start = performance.now();

  const w = window.innerWidth;
  const h = window.innerHeight;

  // –ø—ñ–¥–π–æ–º —Ä–∞–∫–µ—Ç–∏ –∑–Ω–∏–∑—É + 2 –≤–∏–±—É—Ö–∏ (—è–∫ –Ω–∞ –ø—Ä–∏–∫–ª–∞–¥—ñ)
  spawnRocket(w*0.5, h*0.95, h*0.40);
  setTimeout(() => spawnRocket(w*0.62, h*0.95, h*0.52), 160);

  function frame(t){
    if (!fxOn) return;

    // –ª–µ–≥–∫–∏–π fade –∑–∞–º—ñ—Å—Ç—å clear ‚Äî –¥–∞—î ‚Äú—Å–ª—ñ–¥‚Äù
    ctx.globalCompositeOperation = 'source-over';
    ctx.fillStyle = 'rgba(0,0,0,0.22)';
    ctx.fillRect(0,0,w,h);

    // glow —Ä–µ–∂–∏–º
    ctx.globalCompositeOperation = 'lighter';

    // rockets
    for (let i=rockets.length-1;i>=0;i--){
      const r = rockets[i];
      r.life--;

      r.vx *= 0.98;
      r.vy += 0.10; // —Ç—Ä–æ—Ö–∏ ‚Äú–æ–ø–æ—Ä—É/–≥—Ä–∞–≤—ñ—Ç–∞—Ü—ñ—ó‚Äù
      r.x += r.vx + (r.tx - r.x)*0.005;
      r.y += r.vy;

      // —à–ª–µ–π—Ñ
      spawnTrail(r.x, r.y, r.color);

      // —Å–∞–º–∞ ‚Äú—ñ—Å–∫—Ä–∞ —Ä–∞–∫–µ—Ç–∏‚Äù
      ctx.globalAlpha = 1;
      ctx.beginPath();
      ctx.fillStyle = '#fff2d8';
      ctx.arc(r.x, r.y, 2.2, 0, Math.PI*2);
      ctx.fill();

      // –¥–æ—Å—è–≥ —Ü—ñ–ª—ñ ‚Äî –≤–∏–±—É—Ö
      if (r.y <= r.ty || r.life <= 0){
        spawnBloom(r.x, r.y, r.color);
        rockets.splice(i,1);
      }
    }

    // blooms (—Å–µ—Ä—Ü–µ–≤–∏–Ω–∞)
    for (let i=blooms.length-1;i>=0;i--){
      const b = blooms[i];
      b.life--;
      b.r += 7;

      ctx.globalAlpha = Math.max(0, b.life/20) * 0.9;
      const grad = ctx.createRadialGradient(b.x,b.y,0,b.x,b.y,b.r);
      grad.addColorStop(0, 'rgba(255,245,220,0.95)');
      grad.addColorStop(0.35, b.color);
      grad.addColorStop(1, 'rgba(0,0,0,0)');
      ctx.fillStyle = grad;
      ctx.beginPath();
      ctx.arc(b.x,b.y,b.r,0,Math.PI*2);
      ctx.fill();

      if (b.life <= 0) blooms.splice(i,1);
    }

    // sparks (—á–∞—Å—Ç–∏–Ω–∫–∏)
    for (let i=sparks.length-1;i>=0;i--){
      const p = sparks[i];
      p.life--;

      p.x += p.vx;
      p.y += p.vy;
      p.vy += p.g;
      p.vx *= 0.987;
      p.vy *= 0.987;

      // fade
      const a = Math.max(0, Math.min(1, p.life / 85));
      let alpha = a;

      // –º–µ—Ä–µ—Ö—Ç—ñ–Ω–Ω—è
      if (p.tw && Math.random() < 0.22) alpha *= 0.55;

      ctx.globalAlpha = alpha;

      // —è—Å–∫—Ä–∞–≤–∞ —Ç–æ—á–∫–∞
      ctx.beginPath();
      ctx.fillStyle = p.color;
      ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
      ctx.fill();

      // —Ö–≤—ñ—Å—Ç
      ctx.globalAlpha = alpha * (p.ray ? 0.55 : 0.30);
      ctx.strokeStyle = p.color;
      ctx.lineWidth = p.ray ? 1.6 : 1.0;
      ctx.beginPath();
      ctx.moveTo(p.x, p.y);
      ctx.lineTo(p.x - p.vx*2.8, p.y - p.vy*2.8);
      ctx.stroke();

      if (p.life <= 0) sparks.splice(i,1);
    }

    ctx.globalAlpha = 1;

    const done = (t - start > durationMs) && rockets.length === 0 && sparks.length === 0 && blooms.length === 0;
    if (!done) {
      requestAnimationFrame(frame);
    } else {
      fxOn = false;
      fx.classList.remove('on');
      ctx.globalCompositeOperation = 'source-over';
      ctx.clearRect(0,0,w,h);
    }
  }

  requestAnimationFrame(frame);
}
function showMainAfterIntro(){
  intro.classList.add('is-hiding');

  setTimeout(() => {
    intro.classList.add('hidden');
    main.classList.remove('hidden');
  }, 450);
}


    function openAnimation(){
	  envFlap.style.transform = 'rotateX(65deg)';
	  runFireworks(1500);
	  setTimeout(showMainAfterIntro, 1500);
	}

    // Allow skip intro for debugging
    const urlParams = new URLSearchParams(window.location.search);
    const skipIntro = urlParams.get('skipIntro') === '1';
    if (skipIntro) {
      intro.classList.add('hidden');
      main.classList.remove('hidden');
    } else {
      openEnvelope.addEventListener('click', openAnimation, { once: true });
    }

    // =========================
    // Main logic (Whitelist + timer + .ics)
    // =========================
    document.getElementById('year').textContent = new Date().getFullYear();

    const GUESTS = [
      { name: "–ú–∏—Ä–æ–Ω—è–∫ –†–æ–º–∞–Ω" },
      { name: "–õ—É–Ω—ñ–≤–∏ –†–æ–º–∞–Ω", secondName: "–î—ñ–∞–Ω–∞" },
      { name: "–ù—î—Ñ–µ—Ä(–†–æ–º–∞–Ω)", secondName: "–ú–∞—Ä—ñ—è" },
    ];

    const normalize = (s) =>
      (s || "")
        .trim()
        .replace(/\s+/g, " ")
        .toLowerCase();

    const params = new URLSearchParams(window.location.search);
    const rawName = params.get("name");
    const rawSecond = params.get("secondName");

    // –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ ‚Äú—Å–∞–Ω—ñ—Ç–∏–∑–∞—Ü—ñ—è‚Äù –¥–ª—è –≤–∏–≤–æ–¥—É
    const safeText = (s) => (s || "").replace(/[<>]/g, "").trim();

    const name = safeText(rawName);
    const secondName = safeText(rawSecond);

    const nName = normalize(name);
    const nSecond = normalize(secondName);

    function isAllowedGuest() {
      if (!nName) return false;

      return GUESTS.some((g) => {
        const gn = normalize(g.name);
        const gs = normalize(g.secondName);

        // –Ø–∫—â–æ –≥—ñ—Å—Ç—å —É —Å–ø–∏—Å–∫—É —è–∫ –ø–∞—Ä–∞ ‚Äî –ø–æ—Ç—Ä—ñ–±–Ω—ñ –æ–±–∏–¥–≤–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ —ñ —Ç–æ—á–Ω–∏–π –º–∞—Ç—á
        if (gs) return gn === nName && gs === nSecond;

        // –Ø–∫—â–æ –≥—ñ—Å—Ç—å —É —Å–ø–∏—Å–∫—É –æ–¥–∏–Ω ‚Äî –¥–æ–∑–≤–æ–ª—è—î–º–æ —Ç—ñ–ª—å–∫–∏ –∫–æ–ª–∏ secondName –Ω–µ –ø–µ—Ä–µ–¥–∞–ª–∏
        return gn === nName && !nSecond;
      });
    }

    const allowed = isAllowedGuest();

    // ====== 2) PERSONALIZATION + show/hide private info
    const dearLine = document.getElementById("dearLine");
    const topBadge = document.getElementById("topBadge");

    const privateInfo = document.getElementById("privateInfo");
    const timing = document.getElementById("timing");
    const lockedNote = document.getElementById("lockedNote");

    if (allowed) {
      if (name && secondName) {
        dearLine.textContent = `–ú–∏ –¥–æ–≤–≥–æ –¥—É–º–∞–ª–∏‚Ä¶ —è–∫ –Ω–µ —è–∫ 9 —Ä–æ–∫—ñ–≤ üôÉ —ñ –≤–∏—Ä—ñ—à–∏–ª–∏ –æ–¥—Ä—É–∂–∏—Ç–∏—Å—è üíç`;
        topBadge.innerHTML = `${name} —ñ ${secondName} –∑–∞–ø—Ä–æ—à—É—î–º–æ`;
      } else if (name) {
        dearLine.textContent = `–ú–∏ –¥–æ–≤–≥–æ –¥—É–º–∞–ª–∏‚Ä¶ —è–∫ –Ω–µ —è–∫ 9 —Ä–æ–∫—ñ–≤ üôÉ —ñ –≤–∏—Ä—ñ—à–∏–ª–∏ –æ–¥—Ä—É–∂–∏—Ç–∏—Å—è üíç`;
        topBadge.innerHTML = `<b>${name}</b> –∑–∞–ø—Ä–æ—à—É—î–º–æ`;
      }

      privateInfo.classList.remove("hidden");
      timing.classList.remove("hidden");
      lockedNote.classList.add("hidden");
    } else {
      // –ù–µ –∑ whitelist –∞–±–æ –Ω–µ–º–∞—î –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ ‚Äî —Ö–æ–≤–∞—î–º–æ –¥–µ—Ç–∞–ª—ñ
      dearLine.textContent = `–ó–∞–ø—Ä–æ—à–µ–Ω–Ω—è`;
      topBadge.textContent = `–ó–∞–ø—Ä–æ—à–µ–Ω–Ω—è`;

      privateInfo.classList.add("hidden");
      timing.classList.add("hidden");
      lockedNote.classList.remove("hidden");
    }

    // ====== 3) COUNTDOWN (—Ç—ñ–ª—å–∫–∏ —è–∫—â–æ allowed)
    const eventDate = new Date("2025-12-27T12:20:00");

    const pad2 = (v) => String(v).padStart(2, "0");
    const elD = document.getElementById("d");
    const elH = document.getElementById("h");
    const elM = document.getElementById("m");
    const elS = document.getElementById("s");

    function tick() {
      const now = new Date();
      let diff = eventDate.getTime() - now.getTime();

      if (diff <= 0) {
        elD.textContent = "00";
        elH.textContent = "00";
        elM.textContent = "00";
        elS.textContent = "00";
        return;
      }

      const sec = Math.floor(diff / 1000);
      const days = Math.floor(sec / 86400);
      const hours = Math.floor((sec % 86400) / 3600);
      const mins = Math.floor((sec % 3600) / 60);
      const secs = sec % 60;

      elD.textContent = pad2(days);
      elH.textContent = pad2(hours);
      elM.textContent = pad2(mins);
      elS.textContent = pad2(secs);
    }

    if (allowed) {
      tick();
      setInterval(tick, 1000);
    }

    // ====== 4) ADD TO CALENDAR (.ics) (—Ç—ñ–ª—å–∫–∏ —è–∫—â–æ allowed)
    function pad2n(n){ return String(n).padStart(2,'0'); }
    function toICSLocal(dt){
      return (
        dt.getFullYear() +
        pad2n(dt.getMonth()+1) +
        pad2n(dt.getDate()) + 'T' +
        pad2n(dt.getHours()) +
        pad2n(dt.getMinutes()) +
        pad2n(dt.getSeconds())
      );
    }
    function uid(){
      return 'wedding-' + Math.random().toString(16).slice(2) + '@invite';
    }

    const addBtn = document.getElementById('addToCalendarBtn');
    if (addBtn) {
      if (!allowed) {
        addBtn.disabled = true;
        addBtn.classList.add("hidden");
      } else {
        addBtn.addEventListener('click', () => {
          const title = '–í–µ—Å—ñ–ª–ª—è: –Ø–Ω–∏ & –¢–∞—Ä–∞—Å–∞';

          // –ó–ê–ì–û–¢–û–í–ö–ê (—Ç–∏ –ø—ñ–¥—Å—Ç–∞–≤–∏—à –ø–æ—Ç—ñ–º)
          const location = '–†–æ–Ω–¥–µ–ª—å ‚Äî –≤—É–ª–∏—Ü—è –ö—Ä–∞–π–∫—ñ–≤—Å—å–∫–æ–≥–æ, 1–±';

          const who = (name && secondName)
            ? `${name} —ñ ${secondName}`
            : (name ? name : '–ì—ñ—Å—Ç—å');

          const description =
            `–ó–∞–ø—Ä–æ—à–µ–Ω–Ω—è –¥–ª—è: ${who}\n` +
            `–£—Ä–æ—á–∏—Å—Ç–∞ —á–∞—Å—Ç–∏–Ω–∞ ‚Äî 12:20. –ë–∞–Ω–∫–µ—Ç ‚Äî 13:00 —É ‚Äú–†–æ–Ω–¥–µ–ª—å‚Äù.\n` +
            `–ü–æ—Å–∏–ª–∞–Ω–Ω—è: ${window.location.href}`;

          const start = new Date('2025-12-27T12:20:00');
          const end = new Date(start.getTime() + 6 * 60 * 60 * 1000);

          const dtStamp = toICSLocal(new Date());
          const dtStart = toICSLocal(start);
          const dtEnd = toICSLocal(end);

          const ics =
`BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Wedding Invite//UA//EN
CALSCALE:GREGORIAN
METHOD:PUBLISH
BEGIN:VEVENT
UID:${uid()}
DTSTAMP:${dtStamp}
DTSTART:${dtStart}
DTEND:${dtEnd}
SUMMARY:${title}
LOCATION:${location}
DESCRIPTION:${description.replace(/\n/g, '\\n')}
END:VEVENT
END:VCALENDAR`;

          const blob = new Blob([ics], { type: 'text/calendar;charset=utf-8' });
          const url = URL.createObjectURL(blob);

          const a = document.createElement('a');
          a.href = url;
          a.download = 'wedding-invite.ics';
          document.body.appendChild(a);
          a.click();
          a.remove();

          URL.revokeObjectURL(url);
        });
      }
    }
  </script>
</body>
</html>
